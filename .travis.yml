env:
    global:
        # pip dependencies to _build_ your project
        - BUILD_DEPENDS="oldest-supported-numpy"
        # pip dependencies to _test_ your project.  Include any dependencies
        # that you need, that are also specified in BUILD_DEPENDS, this will be
        # a separate install.
        - TEST_DEPENDS="numpy"
        # Now see the Uploads section for the stuff you need to
        # upload your wheels after CI has built them.

# You will likely prefer "language: generic" for travis configuration,
# rather than, say "language: python". Multibuild doesn't use
# Travis-provided Python but rather installs and uses its own, where the
# Python version is set from the MB_PYTHON_VERSION variable. You can still
# specify a language here if you need it for some unrelated logic and you
# can't use Multibuild-provided Python or other software present on a
# builder.
language: generic

# For CPython macOS builds only, the minimum supported macOS version and
# architectures of any C extensions in the wheel are set with the variable
# MB_PYTHON_OSX_VER: 10.9 (64-bit only) or 10.6 (64/32-bit dual arch). By
# default this is set to the highest available for the Python version selected
# using MB_PYTHON_VERSION. You should only need to set this explicitly if you
# are building a 10.6 dual-arch build for a CPython version where both a 10.9 and
# 10.6 build are available (for example, 2.7 or 3.7).
# All PyPy macOS builds are 64-bit only.

# Required in Linux to invoke `docker` ourselves
services: docker

# Host distribution.  This is the distribution from which we run the build
# and test containers, via docker.
dist: xenial

# osx image that enables building Apple silicon libraries
osx_image: xcode12.2

matrix:
  include:

    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.6
        - QUIP_ARCH=darwin_x86_64_gfortran
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.7
        - QUIP_ARCH=darwin_x86_64_gfortran
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.8
        - QUIP_ARCH=darwin_x86_64_gfortran
        - MB_PYTHON_OSX_VER=10.9
    - os: osx
      language: generic
      env:
        - MB_PYTHON_VERSION=3.9
        - QUIP_ARCH=darwin_x86_64_gfortran
        - MB_PYTHON_OSX_VER=10.9
    - os: linux
      env:
        - MB_ML_VER=2010
        - MB_PYTHON_VERSION=3.6
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2010
        - MB_PYTHON_VERSION=3.7
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2010
        - MB_PYTHON_VERSION=3.8
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2010
        - MB_PYTHON_VERSION=3.9
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2014
        - MB_PYTHON_VERSION=3.6
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2014
        - MB_PYTHON_VERSION=3.7
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2014
        - MB_PYTHON_VERSION=3.8
        - QUIP_ARCH=linux_x86_64_gfortran
    - os: linux
      env:
        - MB_ML_VER=2014
        - MB_PYTHON_VERSION=3.9
        - QUIP_ARCH=linux_x86_64_gfortran

before_install:
    - source multibuild/common_utils.sh
    - source multibuild/travis_steps.sh
    - before_install

install:
  - REPO_DIR=QUIP/build/${QUIP_ARCH}
  - build_wheel $REPO_DIR $PLAT

script:
    - install_run $PLAT

after_success:
    # Here you should put the code to upload your wheels
    # See the Uploads section for more details.

deploy:
- provider: releases
  api_key:
    secure: BwKCEsOA/12MulsPa8unDrjEa/AndgSo8n7eQGOotkbn9YmFu2w0rLw1cjKDK5weoBOgb0uccnjowCXKt303HWiO2/mXnEH3S3W/HgbpT5uNH/V5h3zOpj/HBbRspS8FFFXhBoZuE66UcZqg3C/r5GBQrrgHfxxRyu46B74q5J3oskh8cs/yaCEU+BzXg2fv2QjOmtQA8XFfA7LlDXha7GqTzvTNrslYYLInYC+tpJ1ZaAwRQcHVQHmMgu2TniITPJhnrS+1/DbyP12VSD8rA6S9PhRynKztSS9mcnW9eYggJvgbkj8jw6cT1pm+5Nom5K6N8Z2078uWQu+GT6Di8+ajrFpD2q0q3U/5Xt/VZcvr2fxZRY9BXw08poYeRMKEBuRvhMRfTCvOD/fzxE1fiB9lW9Qva4NWq9H9p0spWLjaEnbM55f2tFQbBdaxwMyzd3Po9v1/2WaLrduSrhWh2Ie5IwsdDSiAT+f+M7qP5ob97k4MeFJtn7XGLa9a5rtxoiFiEbtC0AIrzoZV1wEH/ZtmvY+GAjvXQx53UaA/NBRVE8zhsQIuzNFjUvPoIV3oC0NQw9BHGGHx+dN0G+cIjNduEk6elIBCY7X29imZJC+o42KSKLnVNSMzzMt3gxSnhaUzWrwRGsOcneKdSxb59V10zu4nR1us5WUII8PSNgQ=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/${WHEEL_SDIR}/*.whl"
  skip_cleanup: true
  on:
    repo: libAtoms/quippy-wheels
    tags: true
